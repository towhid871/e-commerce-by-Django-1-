{% extends 'base.html' %}
{% load static %}

{% block content %}
<div class="checkout-page">
    <!-- Checkout Header -->
    <div class="checkout-header">
        <h1>CHECK<span class="blue">OUT</span></h1>
        <p>Complete your order in simple steps</p>
    </div>

    <!-- Checkout Steps -->
    <div class="checkout-steps">
        <div class="step active" data-step="1">
            <div class="step-number">1</div>
            <div class="step-title">Cart Review</div>
        </div>
        <div class="step active" data-step="2">
            <div class="step-number">2</div>
            <div class="step-title">Your Details</div>
        </div>
        <div class="step" data-step="3">
            <div class="step-number">3</div>
            <div class="step-title">Confirmation</div>
        </div>
    </div>

    <!-- Checkout Content -->
    <div class="checkout-container">
        <!-- Left Column: Order Details -->
        <div class="order-details">
            <div class="order-summary-card">
                <h2><i class="fas fa-shopping-bag blue"></i> ORDER SUMMARY</h2>
                
                <!-- Cart Items -->
                <div class="checkout-items">
                    {% for item in cart_items %}
                    <div class="checkout-item">
                        <div class="item-image">
                            {% if item.image %}
                            <img src="{{ item.image }}" alt="{{ item.name }}">
                            {% else %}
                            <div class="image-placeholder-small"></div>
                            {% endif %}
                        </div>
                        <div class="item-info">
                            <h4>{{ item.name }}</h4>
                            <p>Qty: {{ item.quantity }}</p>
                        </div>
                        <div class="item-price">
                            ৳{% widthratio item.price 1 item.quantity %}
                        </div>
                    </div>
                    {% endfor %}
                </div>

                <!-- Price Summary -->
                <div class="price-summary">
                    <div class="summary-row">
                        <span>Subtotal ({{ total_items }} items)</span>
                        <span class="amount">৳{{ cart_total }}</span>
                    </div>
                    <div class="summary-row">
                        <span>Shipping</span>
                        <span class="amount">
                            {% if cart_total >= 2000 %}
                            <span class="free">FREE</span>
                            {% else %}
                            ৳100
                            {% endif %}
                        </span>
                    </div>
                    {% if discount_amount > 0 %}
                    <div class="summary-row discount">
                        <span>Special Discount</span>
                        <span class="amount">-৳{{ discount_amount }}</span>
                    </div>
                    {% endif %}
                    <div class="summary-divider"></div>
                    <div class="summary-row total">
                        <span>Total Amount</span>
                        <span class="amount">৳{{ cart_grand_total }}</span>
                    </div>
                </div>

                <!-- Delivery Info -->
                <div class="delivery-info-checkout">
                    <h3><i class="fas fa-shipping-fast blue"></i> DELIVERY INFORMATION</h3>
                    <p><strong>Free Delivery:</strong> On orders above ৳2000</p>
                    <p><strong>Delivery Time:</strong> 3-5 business days</p>
                    <p><strong>Delivery Areas:</strong> All major cities in Bangladesh</p>
                </div>
            </div>

            <!-- Back to Cart -->
            <div class="back-to-cart">
                <a href="{% url 'cart' %}" class="btn">
                    <i class="fas fa-arrow-left"></i> BACK TO CART
                </a>
            </div>
        </div>

        <!-- Right Column: Customer Form -->
        <div class="customer-form-section">
            <div class="form-card">
                <h2><i class="fas fa-user blue"></i> YOUR DETAILS</h2>
                <p class="form-subtitle">We'll call you to confirm your order</p>

                <form id="checkoutForm" method="POST">
                    {% csrf_token %}
                    
                    <!-- Personal Information -->
                    <div class="form-group">
                        <label for="fullName">Full Name *</label>
                        <input type="text" 
                               id="fullName" 
                               name="full_name" 
                               required
                               placeholder="Enter your full name">
                        <div class="error-message" id="nameError"></div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="phoneNumber">Phone Number *</label>
                            <input type="tel" 
                                   id="phoneNumber" 
                                   name="phone_number" 
                                   required
                                   placeholder="01XXXXXXXXX">
                            <div class="error-message" id="phoneError"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="email">Email Address (Optional)</label>
                            <input type="email" 
                                   id="email" 
                                   name="email" 
                                   placeholder="your@email.com">
                            <div class="error-message" id="emailError"></div>
                        </div>
                    </div>

                    <!-- Address Information -->
                    <div class="form-group">
                        <label for="address">Delivery Address *</label>
                        <textarea id="address" 
                                  name="address" 
                                  rows="3" 
                                  required
                                  placeholder="Full address including area, road, house no."></textarea>
                        <div class="error-message" id="addressError"></div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="city">City *</label>
                            <select id="city" name="city" required>
                                <option value="">Select City</option>
                                <option value="Dhaka">Dhaka</option>
                                <option value="Chittagong">Chittagong</option>
                                <option value="Sylhet">Sylhet</option>
                                <option value="Rajshahi">Rajshahi</option>
                                <option value="Khulna">Khulna</option>
                                <option value="Barishal">Barishal</option>
                                <option value="Rangpur">Rangpur</option>
                                <option value="Mymensingh">Mymensingh</option>
                                <option value="Other">Other</option>
                            </select>
                            <div class="error-message" id="cityError"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="area">Area/Thana</label>
                            <input type="text" 
                                   id="area" 
                                   name="area" 
                                   placeholder="e.g., Gulshan, Dhanmondi">
                        </div>
                    </div>

                    <!-- Order Notes -->
                    <div class="form-group">
                        <label for="orderNotes">Order Notes (Optional)</label>
                        <textarea id="orderNotes" 
                                  name="order_notes" 
                                  rows="2"
                                  placeholder="Any special instructions for delivery?"></textarea>
                    </div>

                    <!-- Call Confirmation Note -->
                    <div class="call-confirmation-note">
                        <div class="call-icon">
                            <i class="fas fa-phone-alt"></i>
                        </div>
                        <div class="call-text">
                            <h4>ORDER CONFIRMATION CALL</h4>
                            <p>We will call you at the provided phone number to confirm your order before processing.</p>
                            <p>Please keep your phone nearby after submitting the order.</p>
                        </div>
                    </div>

                    <!-- Terms and Conditions -->
                    <div class="terms-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="terms" name="terms" required>
                            <span>I agree to the <a href="#" class="terms-link">Terms & Conditions</a> and understand that my order will be confirmed via phone call.</span>
                        </label>
                        <div class="error-message" id="termsError"></div>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="btn btn-blue submit-btn">
                        <i class="fas fa-paper-plane"></i> PLACE ORDER
                    </button>
                </form>
            </div>

            <!-- Payment Method Note -->
            <div class="payment-note">
                <h3><i class="fas fa-money-check-alt blue"></i> PAYMENT METHOD</h3>
                <p>Payment will be collected in <strong>Cash on Delivery (COD)</strong>.</p>
                <p>No online payment required. Pay when you receive your order.</p>
            </div>

            <!-- Security Note -->
            <div class="security-note">
                <h3><i class="fas fa-shield-alt blue"></i> SECURE CHECKOUT</h3>
                <p>Your personal information is secure and will only be used for order processing.</p>
                <p>No login required. No passwords to remember.</p>
            </div>
        </div>
    </div>
</div>

<!-- Order Success Modal -->
<div id="orderSuccessModal" class="modal">
    <div class="modal-content success-modal">
        <div class="success-icon">
            <i class="fas fa-check-circle"></i>
        </div>
        <h2>ORDER PLACED SUCCESSFULLY!</h2>
        
        <div class="order-details-modal">
            <p><strong>Order ID:</strong> <span id="modalOrderId">#ORD-{{ random_order_id }}</span></p>
            <p><strong>Customer Name:</strong> <span id="modalCustomerName"></span></p>
            <p><strong>Phone Number:</strong> <span id="modalPhone"></span></p>
            <p><strong>Total Amount:</strong> <span id="modalTotal">৳{{ cart_grand_total }}</span></p>
        </div>

        <div class="call-confirmation-box">
            <div class="call-icon-large">
                <i class="fas fa-phone"></i>
            </div>
            <h3>WE WILL CALL YOU SHORTLY!</h3>
            <p>Our team will call you at <strong id="modalPhoneNumber"></strong> within 30 minutes to confirm your order.</p>
            <p>Please keep your phone nearby.</p>
        </div>

        <div class="modal-actions">
            <button id="downloadInvoice" class="btn btn-blue">
                <i class="fas fa-download"></i> DOWNLOAD INVOICE
            </button>
            <a href="{% url 'home' %}" class="btn">
                <i class="fas fa-home"></i> BACK TO HOME
            </a>
            <a href="{% url 'shop' %}" class="btn">
                <i class="fas fa-shopping-bag"></i> CONTINUE SHOPPING
            </a>
        </div>

        <div class="order-tracking-note">
            <p>Track your order using this link: 
                <a href="#" id="trackingLink">/track-order/<span id="trackingOrderId">ORD-{{ random_order_id }}</span></a>
            </p>
        </div>
    </div>
</div>
{% endblock %}